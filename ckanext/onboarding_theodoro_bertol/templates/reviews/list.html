{% extends "page.html" %}

{% block subtitle %}{{ _('Dataset Reviews') }}{% endblock %}

{% block breadcrumb_content %}
  <li class="active">{{ h.nav_link(_('Dataset Reviews'), named_route='onboarding_reviews.dataset_reviews_list') }}</li>
{% endblock %}

{% block primary_content %}
  <article class="module">
    <div class="module-content">
      <h1 class="page-heading">
        <i class="fa fa-gavel"></i> {{ _('Dataset Reviews') }}
      </h1>
      
      {% if is_reviewer %}
        <div class="alert alert-info">
          <p><i class="fa fa-info-circle"></i> {{ _('As a reviewer, you can see and review datasets that require approval.') }}</p>
        </div>
        
        <!-- Filter buttons -->
        <div class="filters" style="margin-bottom: 20px;">
          <a href="{{ h.url_for('onboarding_reviews.dataset_reviews_list') }}" 
             class="btn {{ 'btn-primary' if not current_filter else 'btn-default' }}">
            {{ _('All') }} ({{ total_count }})
          </a>
          <a href="{{ h.url_for('onboarding_reviews.dataset_reviews_list', review_status='pending') }}" 
             class="btn {{ 'btn-warning' if current_filter == 'pending' else 'btn-default' }}">
            <i class="fa fa-clock-o"></i> {{ _('Pending') }} ({{ facets.get('pending', 0) }})
          </a>
          <a href="{{ h.url_for('onboarding_reviews.dataset_reviews_list', review_status='approved') }}" 
             class="btn {{ 'btn-success' if current_filter == 'approved' else 'btn-default' }}">
            <i class="fa fa-check"></i> {{ _('Approved') }} ({{ facets.get('approved', 0) }})
          </a>
          <a href="{{ h.url_for('onboarding_reviews.dataset_reviews_list', review_status='rejected') }}" 
             class="btn {{ 'btn-danger' if current_filter == 'rejected' else 'btn-default' }}">
            <i class="fa fa-times"></i> {{ _('Rejected') }} ({{ facets.get('rejected', 0) }})
          </a>
        </div>
        
        {% if datasets %}
          <h3>{{ _('Datasets') }} ({{ total_count }})</h3>
          
          <table class="table table-striped table-bordered">
            <thead>
              <tr>
                <th>{{ _('Dataset') }}</th>
                <th>{{ _('Owner') }}</th>
                <th>{{ _('Status') }}</th>
                <th>{{ _('Reviewer') }}</th>
                <th>{{ _('Modified') }}</th>
                <th>{{ _('Actions') }}</th>
              </tr>
            </thead>
            <tbody>
              {% for dataset in datasets %}
                <tr>
                  <td>
                    <a href="{{ h.url_for('dataset.read', id=dataset.id) }}">
                      {{ dataset.title or dataset.name }}
                    </a>
                    {% if dataset.private %}
                      <span class="label label-default">
                        <i class="fa fa-lock"></i> {{ _('Private') }}
                      </span>
                    {% endif %}
                  </td>
                  <td>
                    {% if dataset.creator_user_id %}
                      {{ h.linked_user(dataset.creator_user_id) }}
                    {% else %}
                      {{ _('Unknown') }}
                    {% endif %}
                  </td>
                  <td>
                    {% set review_status = dataset.review_status or 'none' %}
                    {% if review_status == 'approved' %}
                      <span class="label label-success">
                        <i class="fa fa-check"></i> {{ _('Approved') }}
                      </span>
                    {% elif review_status == 'rejected' %}
                      <span class="label label-danger">
                        <i class="fa fa-times"></i> {{ _('Rejected') }}
                      </span>
                    {% elif review_status == 'pending' %}
                      <span class="label label-warning">
                        <i class="fa fa-clock-o"></i> {{ _('Pending') }}
                      </span>
                    {% else %}
                      <span class="label label-default">{{ _('No Review') }}</span>
                    {% endif %}
                  </td>
                  <td>
                    {% if dataset.reviewer_name %}
                      {{ dataset.reviewer_name }}
                      {% if dataset.review_date %}
                        <br><small>{{ h.render_datetime(dataset.review_date) }}</small>
                      {% endif %}
                    {% else %}
                      {{ _('Not reviewed') }}
                    {% endif %}
                  </td>
                  <td>
                    {{ h.time_ago_from_timestamp(dataset.metadata_modified) }}
                  </td>
                  <td>
                    <a href="{{ h.url_for('dataset.read', id=dataset.id) }}" class="btn btn-sm btn-primary">
                      <i class="fa fa-eye"></i> {{ _('View') }}
                    </a>
                    {% if dataset.review_status == 'pending' %}
                      <a href="{{ h.url_for('dataset.read', id=dataset.id) }}#review-actions" class="btn btn-sm btn-warning">
                        <i class="fa fa-gavel"></i> {{ _('Review') }}
                      </a>
                    {% endif %}
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% else %}
          <p>{{ _('No datasets found.') }}</p>
        {% endif %}
      {% else %}
        <div class="alert alert-danger">
          <p><i class="fa fa-exclamation-triangle"></i> {{ _('You do not have permission to view this page.') }}</p>
        </div>
      {% endif %}
    </div>
  </article>
{% endblock %}

{% block secondary_content %}
  <section class="module module-narrow">
    <h2 class="module-heading">
      <i class="fa fa-info-circle"></i> {{ _('About Dataset Reviews') }}
    </h2>
    <div class="module-content">
      <p>{{ _('This page shows all datasets that require review or have been reviewed.') }}</p>
      <p>{{ _('Only datasets you have access to are displayed.') }}</p>
      
      <h3>{{ _('Review Process') }}</h3>
      <ol>
        <li>{{ _('Users create datasets as private') }}</li>
        <li>{{ _('When they try to make them public, they go to pending review') }}</li>
        <li>{{ _('Reviewers approve or reject the datasets') }}</li>
        <li>{{ _('Approved datasets become public') }}</li>
      </ol>
    </div>
  </section>
{% endblock %}